---
title: "rump_data"
author: "Renee Ti Chou"
date: "October 29, 2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

```{r}
library(DGEclustering)
library(org.Dm.eg.db)
library(AnnotationDbi)
setwd('~/Documents/rump_data')
gene.col <- 'gene'
orgdb <- org.Dm.eg.db
keytype <- 'FLYBASE'
dataset1 <- read.table('kc-overexpresion_full.tsv', header=T, quote='', sep='\t')
dataset2 <- read.table('kc-chemical_full.tsv', header=T, quote='', sep='\t')
datasets <- list(dataset1, dataset2)
names(datasets) <- c('treatment1.vs.control', 'treatment2.vs.control')
adjPvalue <- TRUE
x.threshold <- 0.05
y.threshold <- 0.05
sig.res <- sig.subset(datasets, geneCol=gene.col, x.dsNumber=1, y.dsNumber=2, x.threshold=x.threshold, y.threshold=y.threshold, adjPvalue=adjPvalue)
dat <- rbind(sig.res$dis, sig.res$con)
exp <- dat[,grepl("log2FoldChange|pvalue", colnames(dat))]
rownames(exp) <- make.names(dat[,gene.col], unique=TRUE)
genes <- dat[,gene.col]
bg.genes <- dataset1[,gene.col]
ann <- annotate.genes(OrgDb=orgdb, keyType=keytype, genes=genes, GOEnrichment=TRUE, BgGenes=bg.genes)
nb.group=8
```

```{r}
res <- DGE.clust(expressions=exp, annotations=ann, clust.method='agnes', nb.group=nb.group)
res$evaluation
```

```{r}
p <- cluster.plot(datasets, res$groups, x.dsNumber=1, y.dsNumber=2, geneCol=gene.col, adjPvalue=adjPvalue)
p
```

```{r}
p.GO <- cluster.enrich(clusterGroups=res$groups, OrgDb=orgdb, keyType=keytype, BgGenes=bg.genes, 
ont='BP', top=10)
p.GO
```

```{r}
res2 <- DGE.clust(expressions=exp, annotations=ann, integrate.method='new', clust.method='agnes', nb.group=nb.group, OrgDb=orgdb, keyType=keytype, nb.dim=2)
res2$evaluation
```

```{r}
p2 <- cluster.plot(datasets, res2$groups, x.dsNumber=1, y.dsNumber=2, geneCol=gene.col, adjPvalue=adjPvalue)
p2
```
