---
title: "rump_data"
author: "Renee Ti Chou"
date: "October 29, 2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

```{r}
library(DGEclustering)
library(org.Dm.eg.db)
library(AnnotationDbi)
setwd('~/Documents/rump_data')
gene.col <- 'gene'
orgdb <- org.Dm.eg.db
keytype <- 'FLYBASE'
dataset1 <- read.table('kc-overexpresion_full.tsv', header=T, quote='', sep='\t')
dataset2 <- read.table('kc-chemical_full.tsv', header=T, quote='', sep='\t')
datasets <- list(dataset1, dataset2)
names(datasets) <- c('treatment1.vs.control', 'treatment2.vs.control')
adjPvalue <- TRUE
x.threshold <- 0.05
y.threshold <- 0.05
sig.res <- sig.subset(datasets, geneCol=gene.col, x.dsNumber=1, y.dsNumber=2, x.threshold=x.threshold, y.threshold=y.threshold, adjPvalue=adjPvalue)
dat <- rbind(sig.res$dis, sig.res$con)
exp <- dat[,grepl("log2FoldChange|pvalue", colnames(dat))]
rownames(exp) <- make.names(dat[,gene.col], unique=TRUE)
genes <- dat[,gene.col]
bg.genes <- dataset1[,gene.col]
ann <- annotate.genes(OrgDb=orgdb, keyType=keytype, genes=genes, GOEnrichment=TRUE, BgGenes=bg.genes)
nb.group=8
```

```{r}
res <- DGE.clust(expressions=exp, annotations=ann, clust.method='agnes', nb.group=nb.group)
res$evaluation
```

```{r}
p <- cluster.plot(datasets, res$groups, x.dsNumber=1, y.dsNumber=2, geneCol=gene.col, adjPvalue=adjPvalue)
p
```

```{r}
p.GO <- cluster.enrich(clusterGroups=res$groups, OrgDb=orgdb, keyType=keytype, BgGenes=bg.genes, 
ont='BP', top=10)
p.GO
```

```{r}
res2 <- DGE.clust(expressions=exp, annotations=ann, integrate.method='new', clust.method='agnes', nb.group=nb.group, OrgDb=orgdb, keyType=keytype, nb.dim=2)
res2$evaluation
```

```{r}
p2 <- cluster.plot(datasets, res2$groups, x.dsNumber=1, y.dsNumber=2, geneCol=gene.col, adjPvalue=adjPvalue)
p2
```

```{r}
sessionInfo()
# R version 3.4.1 (2017-06-30)
# Platform: x86_64-pc-linux-gnu (64-bit)
# Running under: Fedora 28 (Twenty Eight)
# 
# Matrix products: default
# BLAS: /home/guest/miniconda3/envs/r-dgeclustering_2/lib/R/lib/libRblas.so
# LAPACK: /home/guest/miniconda3/envs/r-dgeclustering_2/lib/R/lib/libRlapack.so
# 
# locale:
#  [1] LC_CTYPE=en_US.utf8       LC_NUMERIC=C
#  [3] LC_TIME=en_US.utf8        LC_COLLATE=en_US.utf8
#  [5] LC_MONETARY=en_US.utf8    LC_MESSAGES=en_US.utf8
#  [7] LC_PAPER=en_US.utf8       LC_NAME=C
#  [9] LC_ADDRESS=C              LC_TELEPHONE=C
# [11] LC_MEASUREMENT=en_US.utf8 LC_IDENTIFICATION=C
# 
# attached base packages:
# [1] parallel  stats4    stats     graphics  grDevices utils     datasets
# [8] methods   base
# 
# other attached packages:
# [1] org.Dm.eg.db_3.5.0   AnnotationDbi_1.40.0 IRanges_2.12.0
# [4] S4Vectors_0.16.0     Biobase_2.38.0       BiocGenerics_0.24.0
# [7] DGEclustering_0.1.0  cluster_2.0.7-1      FactoMineR_1.38
# 
# loaded via a namespace (and not attached):
#  [1] httr_1.3.1                    tidyr_0.8.1
#  [3] bit64_0.9-7                   AnnotationHub_2.10.1
#  [5] splines_3.4.1                 shiny_1.1.0
#  [7] assertthat_0.2.0              DO.db_2.9
#  [9] interactiveDisplayBase_1.16.0 rvcheck_0.1.0
# [11] blob_1.1.1                    yaml_2.2.0
# [13] pillar_1.3.0                  RSQLite_2.1.1
# [15] lattice_0.20-35               glue_1.3.0
# [17] rlist_0.4.6.1                 digest_0.6.18
# [19] promises_1.0.1                qvalue_2.12.0
# [21] colorspace_1.3-2              httpuv_1.4.5
# [23] htmltools_0.3.6               Matrix_1.2-14
# [25] plyr_1.8.4                    pkgconfig_2.0.2
# [27] clusterProfiler_3.6.0         xtable_1.8-3
# [29] purrr_0.2.5                   GO.db_3.5.0
# [31] scales_1.0.0                  later_0.7.3
# [33] BiocParallel_1.14.2           tibble_1.4.2
# [35] ggplot2_3.1.0                 lazyeval_0.2.1
# [37] mime_0.5                      InteGO_2.0
# [39] magrittr_1.5                  crayon_1.3.4
# [41] memoise_1.1.0                 DOSE_3.4.0
# [43] MASS_7.3-50                   BiocInstaller_1.28.0
# [45] tools_3.4.1                   data.table_1.11.6
# [47] stringr_1.3.1                 munsell_0.5.0
# [49] bindrcpp_0.2.2                flashClust_1.01-2
# [51] compiler_3.4.1                rlang_0.3.0.1
# [53] grid_3.4.1                    leaps_3.0
# [55] igraph_1.2.2                  gtable_0.2.0
# [57] DBI_1.0.0                     reshape2_1.4.3
# [59] R6_2.2.2                      gridExtra_2.3
# [61] dplyr_0.7.6                   bit_1.1-12
# [63] bindr_0.1.1                   fastmatch_1.1-0
# [65] fgsea_1.6.0                   GOSemSim_2.4.0
# [67] stringi_1.2.4                 Rcpp_0.12.17
# [69] png_0.1-7                     scatterplot3d_0.3-41
# [71] tidyselect_0.2.4
```
